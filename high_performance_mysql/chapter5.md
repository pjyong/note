# 创建高性能的索引

索引优化是查询性能优化最有效的手段

## 5.1-索引基础

### B-Tree索引

* 节点页和叶子页组成。节点页是由多个_key+指针(指向子页)_组成。叶子页是由多个_val_和一个_指针(指向下一个叶子页)_组成，其中val必须在父页指针区前后两个key范围之内。
* 每一个叶子页到根的距离相同，单个叶子都指向每行数据存储(聚簇索引:innodb会将数据直接存放在单个叶子里面)。
* 数的深度和表的大小直接相关。

这里就可以解释多列索引的最左匹配了。

## 5.2-索引的优点

* 大大减少服务器需要扫描的数据量
* 可以帮助服务器避免排序和临时表
* 可以将随机I/O变成顺序I/O

## 5.4-索引案例学习

如果MySQL使用某个索引的范围查询，也就无法使用另一个索引或者该索引的后续字段。

### 多用IN来减少索引。

性别需要建索引吗？
如果绝大多数查询都涉及到性别，那就将性别作为索引的前缀(参考“索引覆盖”)。更重要的是，这样也没什么坏处。针对没有查询性别的SQL，可以在WHERE后面加上`SEX IN ('m', 'f')`来让SQL选择该索引。

### 优化排序
```
/*错误做法*/
SELECT * FROM orders ORDER BY Rating LIMIT 10000,0
/*正确做法*/
SELECT * FROM orders INNER JOIN (
  SELECT ID FROM orders ORDER BY Rating LIMIT 10000,0
) AS x USING(ID)
```
